language: python

# Cache dependencies between builds
cache: pip

python:
  - '3.6'

services:
  - postgresql
  - redis-server

install:
  - pip install -r requirements.txt
  - pip install git+https://github.com/Supervisor/supervisor.git

before_script:
  - supervisord
  - psql -c 'create database oser_showcase_backend_db;' -U postgres
  - cd project
  - python manage.py migrate

script:
  - python manage.py test

before_deploy:
  - cd .. && ls

deploy:
  provider: heroku
  app:
    # direct each branch to the corresponding app
    master: oser-showcase-backend
    staging: oser-showcase-backend-staging
  run:
    - 'python project/manage.py migrate'
  api_key:
    # Encrypted API key obtained from the following command
    # (requires TravisCI and Heroku CLI installed)
    # $ travis encrypt $(heroku auth:token) --add deploy.api_key
    secure: tk6Pfrftlma+m6TYwl3DODf4rrtoPbvL5C94rBWEyjE3ttyitFIMqWAhG/lVR83ZmCd+sGvm250fqKes2+ZINYW92csvu9vngG4018qzDJ0agA2wOsNkn+mMih96hk+uWpRHWZ90BDG/wWcWnquSzS2fNNmdJVS5lEH4lPQBrgN0dTlHROHnFn5eJK7BR/22EOfF2wmREdMohn7QDBalju+C5ywGKNVYJ9Lhychlp/LbemrHViIXheCO3dS0Lu+AsQaH0Gh+793tmHWqRJhY4EP0IKi6xguH9/b80hkgAH8zZYo8HOXCGBUJnTNWJsf5H4Dvcoeny0p6ak/oyudwO/ZEQB0bs5MeAa5yCunEb6nCnpmPy+spvVjK3ZSGLhfetYHn44tApzFNnqOJPnHSFHy0Tbi/RDFpH6998iUWx7MbXsjsxLnj1C/c53l5xg9YxbZKp8YBNlmwMKdBaEnZEiHyVBhJG05JVnacMUAajtOisObG2yKBjcgUxNuTRIFlSj8UKKlF+wnjrRQLGHK32ISkE+g4NAePtqU5W4hjKqpMvv9uNEopkGb9XNo+9PWN168s7trKWcLIaqNykAVS/0LUYomuV2tMdIcP7biYO84r1YRmFFblTIb19vFsQNagRRZ27gFnjozPufVmDF8tp3buEeEkRTDZZIcJfoGoJFM=
